<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Arquillian Persistence Extension</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Arquillian Persistence Extension</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#what-is-this">1.1. What Is This?</a></li>
<li><a href="#containers-used-for-testing">1.2. Containers Used For Testing</a></li>
<li><a href="#verified-with-following-databases">1.3. Verified With Following Databases</a></li>
<li><a href="#code-example">1.4. Code Example</a></li>
</ul>
</li>
<li><a href="#guide">2. Guide</a>
<ul class="sectlevel2">
<li><a href="#_getting_started">2.1. Getting Started</a></li>
<li><a href="#transactional-tests">2.2. Transactional Tests</a></li>
<li><a href="#seeding-database">2.3. Seeding Database</a></li>
<li><a href="#verfying-database-content-after-the-test">2.4. Verifying Database Content After The Test</a></li>
<li><a href="#data-insert-strategies">2.5. Data Insert Strategies</a></li>
<li><a href="#cleaning-your-data">2.6. Cleaning Your Data</a></li>
<li><a href="#additional-configuration">2.7. Additional Configuration</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>1. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="what-is-this"><a class="anchor" href="#what-is-this"></a>1.1. What Is This?</h3>
<div class="paragraph">
<p><strong>Arquillian Persistence Extension</strong> was created to help you write tests
where persistence layer is involved. Inspired by great framework called
<a href="http://unitils.org/">Unitils</a>, it brings a bunch of annotations to help you
deal with the underlying data storage.</p>
</div>
<div class="paragraph">
<p>It comes with following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Wrapping each test in the separated transaction (with
<strong>commit</strong> (default) or <strong>rollback</strong> at the end).</p>
</li>
<li>
<p>Seeding database using:</p>
<div class="ulist">
<ul>
<li>
<p><a href="http://dbunit.sourceforge.net/">DBUnit</a> with <strong>XML</strong>, <strong>XLS</strong>, <strong>YAML</strong>
and <strong>JSON</strong> supported as data sets format.</p>
</li>
<li>
<p>Custom SQL scripts.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Comparing database state at the end of the test using given data sets
(with column exclusion).</p>
</li>
<li>
<p>Eviction JPA second level cache between test method invocation, see
<code>@JpaCacheEviction</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="containers-used-for-testing"><a class="anchor" href="#containers-used-for-testing"></a>1.2. Containers Used For Testing</h3>
<div class="ulist">
<ul>
<li>
<p>Glassfish 3.1.2 Embedded</p>
</li>
<li>
<p>JBoss AS 7.0.2 Final (managed)</p>
</li>
<li>
<p>JBoss AS 7.1.1.Final (managed)</p>
</li>
<li>
<p>Wildfly 8.1</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="verified-with-following-databases"><a class="anchor" href="#verified-with-following-databases"></a>1.3. Verified With Following Databases</h3>
<div class="ulist">
<ul>
<li>
<p>HSQL</p>
</li>
<li>
<p>MS SQL 2008 Express (with Microsoft JDBC Driver)</p>
</li>
<li>
<p>MySQL 5.5.24</p>
</li>
<li>
<p>PostgreSQL 9.1.4</p>
</li>
<li>
<p>Oracle 11g</p>
</li>
<li>
<p>Derby</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Enough talking, let&#8217;s see it in action!</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="code-example"><a class="anchor" href="#code-example"></a>1.4. Code Example</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserPersistenceTest</span>
{

  <span class="annotation">@Deployment</span>
  <span class="directive">public</span> <span class="directive">static</span> Archive&lt;?&gt; createDeploymentPackage()
  {
      <span class="keyword">return</span> ShrinkWrap.create(JavaArchive.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">test.jar</span><span class="delimiter">&quot;</span></span>)
                       .addPackage(UserAccount.class.getPackage())
                       .addPackages(<span class="predefined-constant">true</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.fest</span><span class="delimiter">&quot;</span></span>) <span class="comment">// FEST Assert is not part of Arquillian</span>
                       .addAsManifestResource(EmptyAsset.INSTANCE, <span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>)
                       .addAsManifestResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">test-persistence.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">persistence.xml</span><span class="delimiter">&quot;</span></span>);
  }

  <span class="annotation">@PersistenceContext</span>
  EntityManager em;

  <span class="annotation">@Test</span>
  <span class="annotation">@UsingDataSet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">datasets/users.yml</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@ShouldMatchDataSet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">datasets/expected-users.yml</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="type">void</span> should_change_user_password() <span class="directive">throws</span> <span class="exception">Exception</span>
  {
      <span class="comment">// given</span>
      <span class="predefined-type">String</span> expectedPassword = <span class="string"><span class="delimiter">&quot;</span><span class="content">LexLuthor</span><span class="delimiter">&quot;</span></span>;
      UserAccount user = em.find(UserAccount.class, <span class="integer">2L</span>);

      <span class="comment">// when</span>
      user.setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">LexLuthor</span><span class="delimiter">&quot;</span></span>);
      em.merge(user);

      <span class="comment">// then</span>
      assertThat(user.getPassword()).isEqualTo(expectedPassword);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are just two things which are different from the standard
Arquillian test - <code>@UsingDataSet</code> and <code>@ShouldMatchDataSet</code> annotations.
Former seeds the database using file in YAML format, and latter verifies
database state using given file.</p>
</div>
<div class="paragraph">
<p>This example is taken from <strong>integration tests</strong> written for this project,
so feel free to have a closer look.</p>
</div>
<div class="paragraph">
<p>But it&#8217;s that easy! And there&#8217;s more to come!</p>
</div>
<div class="paragraph">
<p>If you have any questions or would like to file feature request or bug
report (hope not!) please have a look at
<a href="http://arquillian.org/community/">the ways how you can get in touch with
us</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="guide"><a class="anchor" href="#guide"></a>2. Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_getting_started"><a class="anchor" href="#_getting_started"></a>2.1. Getting Started</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#maven-setup">Maven Setup</a></p>
</li>
<li>
<p><a href="#see-it-in-action">See It In Action</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="maven-setup"><a class="anchor" href="#maven-setup"></a>2.1.1. Maven Setup</h4>
<div class="paragraph">
<p>You&#8217;ll first need to setup Arquillian in your project. You can find
instructions in the
<a href="http://arquillian.org/guides/getting_started/#add_the_arquillian_apis">Getting
Started guide</a>. You&#8217;ll also need to add an Arquillian container adapter
for a container which provides JPA. Any Java EE 6 server will do, such
as JBoss AS 7 or GlassFish 3.1. Adding the required container adapter to
your project is also covered in the
<a href="http://arquillian.org/guides/getting_started/#add_more_containers">Getting
Started guide</a>.</p>
</div>
<div class="paragraph">
<p>The only extra dependency you need is the Arquillian Persistence
Extension implementation, <code>arquillian-persistence-dbunit</code>
(formerÂ <code>arquillian-persistence-impl</code>), as shown in the snippet below.</p>
</div>
<div class="paragraph">
<p>Maven dependency for Arquillian Persistence Extension</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jboss.arquillian.extension<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>arquillian-persistence-dbunit<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${version.arquillian.persistence}<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="see-it-in-action"><a class="anchor" href="#see-it-in-action"></a>2.1.2. See It In Action</h4>
<div class="paragraph">
<p>Here is an Arquillian-powered test with Persistence Extension.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">UserPersistenceTest</span> {

    <span class="annotation">@Deployment</span>
    <span class="directive">public</span> <span class="directive">static</span> Archive&lt;?&gt; createDeploymentPackage() {
        <span class="keyword">return</span> ShrinkWrap.create(JavaArchive.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">test.jar</span><span class="delimiter">&quot;</span></span>)
                .addPackage(UserAccount.class.getPackage())
                .addAsManifestResource(EmptyAsset.INSTANCE, <span class="string"><span class="delimiter">&quot;</span><span class="content">beans.xml</span><span class="delimiter">&quot;</span></span>)
                .addAsManifestResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">test-persistence.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">persistence.xml</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@PersistenceContext</span>
    EntityManager em;

    <span class="annotation">@Test</span>
    <span class="annotation">@UsingDataSet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">datasets/users.yml</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@ShouldMatchDataSet</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">datasets/expected-users.yml</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> should_change_user_password() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="comment">// given</span>
        <span class="predefined-type">String</span> expectedPassword = <span class="string"><span class="delimiter">&quot;</span><span class="content">LexLuthor</span><span class="delimiter">&quot;</span></span>;
        UserAccount user = em.find(UserAccount.class, <span class="integer">2L</span>);

        <span class="comment">// when</span>
        user.setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="content">LexLuthor</span><span class="delimiter">&quot;</span></span>);
        user = em.merge(user);

        <span class="comment">// then</span>
        assertEquals(expectedPassword, user.getPassword());
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">users.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">useraccount:
  - id: <span class="integer">1</span>
    firstname: John
    lastname: Smith
    username: doovde
    password: password
  - id: <span class="integer">2</span>
    firstname: Clark
    lastname: Kent
    username: superman
    password: kryptonite</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">expected-users.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">useraccount:
  - firstname: John
    lastname: Smith
    username: doovde
    password: password
  - firstname: Clark
    lastname: Kent
    username: superman
    password: LexLuthor</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are just two things which are different from the standard
Arquillian test - <code>@UsingDataSet</code> and <code>@ShouldMatchDataSet annotations</code>.
Former seeds the database using file in
<a href="http://en.wikipedia.org/wiki/YAML">YAML</a> format, and latter verifies
database state using given file. Read on to learn more about the
features offered by <strong>Arquillian Persistence Extension</strong>. If you want to
see more core have a look at
<a href="https://github.com/arquillian/arquillian-showcase/tree/master/jpa-persistence-extension">our
showcase on Github</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="transactional-tests"><a class="anchor" href="#transactional-tests"></a>2.2. Transactional Tests</h3>
<div class="paragraph">
<p>Adding transaction support to your tests is pretty straightforward. If
that&#8217;s only what you need simply put <code>@Transactional</code> annotation
either on the test which you want be wrapped in transaction or on the
test class which will result with all tests running in their
transactions.</p>
</div>
<div class="paragraph">
<p><strong>Following modes are supported:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COMMIT</code>: Each test will be finished with <code>commit</code> operation. This is
<strong>default</strong> behaviour.</p>
</li>
<li>
<p><code>ROLLBACK</code>: At the end of the test execution <code>rollback</code> will be
performed</p>
</li>
<li>
<p><code>DISABLED</code>: If you have enabled transactional support on the test
class level, marking given test with this mode will simply run it
without the transaction.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="seeding-database"><a class="anchor" href="#seeding-database"></a>2.3. Seeding Database</h3>
<div class="paragraph">
<p>Creating ad-hoc object graphs in the test code is often too verbose and
makes it harder to read the tests. Arquillian Persistence Extension
provides alternatives to set database fixtures to be used for the given
test as described below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#data-sets">Data Sets</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#flat-xml-data-set">Flat XML Data Set</a></p>
</li>
<li>
<p><a href="#excel-spreadsheets">Excel Spreadsheets</a></p>
</li>
<li>
<p><a href="#yaml-and-json">YAML and JSON</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#schema-creation">Schema Creation</a></p>
</li>
<li>
<p><a href="#custom-sql-scripts">Custom SQL Scripts</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="data-sets"><a class="anchor" href="#data-sets"></a>2.3.1. Data Sets</h4>
<div class="paragraph">
<p>If you are familiar with <a href="http://dbunit.sourceforge.net">DBUnit</a> you already know the
concept of data sets. In brief data sets are files containing rows to be
inserted to the database. In order to seed your database using data set
file put <code>@UsingDataSet</code> annotation either on the test itself or on the
class level. If there is definition on both, test level annotation takes
precedence. In addition you can specify files location in the annotation
(default folder is "datasets/". Refer to <a href="additional-configuration.html#dbunit-specific-settings">DBUnit configuration section</a> to see how can you customize it). If files are
not specified explicitly, following strategy is applied:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s assumed that files are stored in <code>datasets</code> folder on classpath
(or any other you have configured as default location).</p>
</li>
<li>
<p>If annotation is defined on method level, file name has following
format:
<code>[fully qualified class name]#[test method name].[default format]</code>.</p>
</li>
<li>
<p>If annotation is defined on class level, file name has following
format: <code>[fully qualified class name].[default format]</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where <code>default format</code> is XML, but <a href="additional-configuration.html#dbunit-specific-settings">can be also
customized</a>.</p>
</div>
<div class="paragraph">
<p>Arquillian Persistence Extension handles following formats available out
of the box in DBUnit:</p>
</div>
<div class="sect4">
<h5 id="flat-xml-data-set"><a class="anchor" href="#flat-xml-data-set"></a>Flat XML Data Set</h5>
<div class="paragraph">
<p>Simple XML format where each element represents rows in the given table
and attributes names corresponds to its columns. You can also explicitly
set <code>null</code> value for the given column, by simply using <code>[null]</code> keyword,
as illustrated below.</p>
</div>
<div class="paragraph">
<p>Flat XML Data Set</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dataset&gt;</span>
    <span class="tag">&lt;useraccount</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">firstname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Clark</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">lastname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Kent</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ckent</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LexLuthor123</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">nickname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">[null]</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/dataset&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="excel-spreadsheets"><a class="anchor" href="#excel-spreadsheets"></a>Excel Spreadsheets</h5>
<div class="paragraph">
<p>Another format supported out of the box by DBUnit. In order to use it
follow these conventions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Each table should have dedicated sheet within the Excel file.</p>
</li>
<li>
<p>First row should contain column labels.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Have a look at the
<a href="https://github.com/arquillian/arquillian-extension-persistence/blob/master/int-tests/src/test/resources-datasets/datasets/single-user.xls">example</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="yaml-and-json"><a class="anchor" href="#yaml-and-json"></a>YAML and JSON</h5>
<div class="paragraph">
<p>In addition to the format supported out of the box by DBUnit, Arquillian
Persistence Extension provides alternative way to describe your data
sets either by using YAML or JSON. Those formats are a bit more readable
for the human (and for machines too!). So instead of hand-crafting XML
or Excel files you can do define your data sets in
<a href="http://en.wikipedia.org/wiki/YAML">YAML</a>:</p>
</div>
<div class="paragraph">
<p>Data set described in YAML</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">useraccount:
  - id: <span class="integer">1</span>
    firstname: Clark
    lastname: Kent
    username: ckent
    password: LexLuthor123
    nickname: <span class="string"><span class="delimiter">&quot;</span><span class="content">[null]</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or in <a href="http://en.wikipedia.org/wiki/JavaScript_Object_Notation">JSON</a>:</p>
</div>
<div class="paragraph">
<p>Data set described in JSON</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">{
  <span class="string"><span class="delimiter">&quot;</span><span class="content">useraccount</span><span class="delimiter">&quot;</span></span>:
  [
    {
      <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">firstname</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Clark</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">lastname</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">Kent</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">ckent</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">LexLuthor123</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">nickname</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">[NULL]</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="schema-creation"><a class="anchor" href="#schema-creation"></a>2.3.2. Schema Creation</h4>
<div class="paragraph">
<p>If you want to use custom SQL scripts for schema creation you can
decorate your test using <code>@CreateSchema</code> annotation providing list of
scripts you want to execute before test class. They will be executed
only once. By convention such scripts will be first looked in <strong>schema</strong>
folder, but you can also provide full path if you wish.</p>
</div>
</div>
<div class="sect3">
<h4 id="custom-sql-scripts"><a class="anchor" href="#custom-sql-scripts"></a>2.3.3. Custom SQL Scripts</h4>
<div class="paragraph">
<p>If you want you can also use seed your database using plain SQL (or
execute any other action directly on the database level). To achieve it
simply put <code>@ApplyScriptBefore</code> or <code>@ApplyScriptAfter</code> annotation either
directly on your test method or on the test class. Scripts will be
executed before or after test method accordingly. If there is definition
on both, test level annotation takes precedence.</p>
</div>
<div class="paragraph">
<p>By convention Arquillian Persistence Extension will look for these
scripts in theÂ <strong>scripts</strong> folder (in a Maven project, that&#8217;s typically
<code>src/test/resources/scripts</code> in the source tree), but you can customize
it as you wish - see <a href="additional-configuration.html#general-settings">configuration
section</a> how to do it. You can also specify files location in the
annotation, the same way as you can do with DBUnit data sets. If files
are not specified explicitly, following strategy is applied:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s assumed that files are stored in <code>scripts</code> folder (or any other
you have configured as default location).</p>
</li>
<li>
<p>If annotation is defined on method level, file name has following
format:
<code>[before|after]-[fully qualified class name]#[test method name].sql</code>.</p>
</li>
<li>
<p>If annotation is defined on class level, file name has following
format: <code>[before|after]-[fully qualified class name].sql</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verfying-database-content-after-the-test"><a class="anchor" href="#verfying-database-content-after-the-test"></a>2.4. Verifying Database Content After The Test</h3>
<div class="paragraph">
<p>Sometimes it might be a bit cumbersome to assert database state directly
from your testing code. Especially when you change quite a lot in the
database tables you might want to validate values directly in the
database. By using DBUnit you can use the same data sets approach. Put
<code>@ShouldMatchDataSet</code> annotation either on the test method or your test
class and Arquillian Persistence Extension will use all these files
together to check if database contains entries you are expecting after
test execution. Again, by convention it first looks for the files in
<code>datasets</code> folder. If you don&#8217;t provide file names in the annotation
itself following rules are applied:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s assumed that files are stored in <code>datasets</code> folder (or any other
you have configured as default location).</p>
</li>
<li>
<p>If annotation is defined on method level, file name has following
format
<code>expected-[fully qualified class name]#[test method name].[default format]</code></p>
</li>
<li>
<p>If annotation is defined on class level, file name has following
format <code>expected-[fully qualified class name].[default format].</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Where <code>default format</code> is XML, but <a href="additional-configuration.html#dbunit-specific-settings">can be also
customized</a>.</p>
</div>
<div class="paragraph">
<p>In addition you can also specify which columns should not be used for
comparision. This might be handy if you export large datasets directly
from the database using tools like
<a href="http://jailer.sourceforge.net/">Jailer</a> and you don&#8217;t want to compare
surrogate keys (database generated ids). You can specify these columns
in the annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ShouldMatchDataSet</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">expected-users.yml</span><span class="delimiter">&quot;</span></span>, excludeColumns = { <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">creationDate</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
<div class="paragraph">
<p>To determine order of data sets comparison you can use <code>orderBy</code>
attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ShouldMatchDataSet</span>(value = <span class="string"><span class="delimiter">&quot;</span><span class="content">expected-users.yml</span><span class="delimiter">&quot;</span></span>, orderBy = { <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>})</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="data-insert-strategies"><a class="anchor" href="#data-insert-strategies"></a>2.5. Data Insert Strategies</h3>
<div class="paragraph">
<p>DBUnit, and hence Arquillian Persistence Extension, provides following
strategies for inserting data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>INSERT</code><br>
Performs insert of the data defined in provided data sets.Â This is the
default strategy.</p>
</li>
<li>
<p><code>CLEAN_INSERT</code><br>
Performs insert of the data defined in provided data sets, after removal
of all data present in the tables (DELETE_ALL invoked by DBUnit before
INSERT).</p>
</li>
<li>
<p><code>REFRESH</code><br>
During this operation existing rows are updated and new ones are
inserted. Entries already existing in the database which are not defined
in the provided data set are not affected.</p>
</li>
<li>
<p><code>UPDATE</code><br>
This strategy updates existing rows using data provided in the datasets.
If dataset contain a row which is not present in the database
(identified by its primary key) then exception is thrown.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Data seeding strategy can be specified globally in <code>arquillian.xml</code>.
Please refer to the <a href="additional-configuration.html#general-settings">configuration
section</a> for the details.</p>
</div>
</div>
<div class="sect2">
<h3 id="cleaning-your-data"><a class="anchor" href="#cleaning-your-data"></a>2.6. Cleaning Your Data</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#dbunit-cleanup-modes">DBUnit Cleanup Modes</a></p>
</li>
<li>
<p><a href="#using-custom-sql-scripts-for-cleanup">Using Custom SQL Scripts For Cleanup</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="dbunit-cleanup-modes"><a class="anchor" href="#dbunit-cleanup-modes"></a>2.6.1. DBUnit Cleanup Modes</h4>
<div class="paragraph">
<p>Arquillian Persistence Extension comes with great degree of
configuration. In combination with data sets which you use to seed the
database you can also specify when and how you would like your database
to be cleaned. By default your database is entirely erased before each
test. If you want to control this behavior, use <code>@Cleanup</code> annotation
for this purpose. You can define it on the test method level or globally
by decorating test class. Following modes are currently supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>STRICT</code><br>
Cleans the entire database. This strategy might require turning off
database constraints (e.g. referential integrity).</p>
</li>
<li>
<p><code>USED_ROWS_ONLY</code><br>
Deletes only those entries which were defined in data sets used for
seeding.</p>
</li>
<li>
<p><code>USED_TABLES_ONLY</code><br>
Deletes only those tables which were used in data sets.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also specify when you would like to invoke the cleanup
procedure. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Cleanup</span>(phase = TestExecutionPhase.AFTER, strategy = CleanupStrategy.USED_ROWS_ONLY)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can invoke it <code>BEFORE</code> or <code>AFTER</code> the test. You can also disable
cleanup by using <code>TestExecutionPhase.NONE</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-custom-sql-scripts-for-cleanup"><a class="anchor" href="#using-custom-sql-scripts-for-cleanup"></a>2.6.2. Using Custom SQL Scripts For Cleanup</h4>
<div class="paragraph">
<p>You can also use custom SQL scripts to clean your database before or
after the test. For this purpose use <code>@CleanupUsingScript</code> annotation
and specifies SQL files which have to be executed. If you don&#8217;t provide
file names in the annotation itself following rules are applied:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s assumed that files are stored in <code>scripts</code> folder (or any other
you have configured as default location).</p>
</li>
<li>
<p>If annotation is defined on method level, file name has following
format <code>cleanup-[fully qualified class name]#[test method name].sql</code></p>
</li>
<li>
<p>If annotation is defined on class level, file name has following
format <code>cleanup-[fully qualified class name].sql</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The same way as with DBUnit cleanup you can also define test phase when
it should take place.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="additional-configuration"><a class="anchor" href="#additional-configuration"></a>2.7. Additional Configuration</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#other-goodies">Other Goodies</a></p>
</li>
<li>
<p><a href="#additional-configuration-1">Additional Configuration</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#general-settings">General Settings</a></p>
</li>
<li>
<p><a href="#dbunit-specific-settings">DBUnit Specific Settings</a></p>
</li>
<li>
<p><a href="#sql-scripts-customization">SQL Scripts Customization</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="other-goodies"><a class="anchor" href="#other-goodies"></a>2.7.1. Other Goodies</h4>
<div class="ulist">
<ul>
<li>
<p>You can use <code>scriptsToExecuteBeforeTest</code>Â and <code>scriptsToExecuteAfterTest</code>Â scripts to turn off and bring back referential
integrity checks for each tests using single, global definition
externalized from the test class. This way your tests are portable and
you can use different profiles with database specific <code>arquillian.xml</code>
configurations transparently.</p>
</li>
<li>
<p>You can dump database content for each test execution and use it later
for debugging purposes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See following section for details on how to configure those features.</p>
</div>
</div>
<div class="sect3">
<h4 id="additional-configuration-1"><a class="anchor" href="#additional-configuration-1"></a>2.7.2. Additional Configuration</h4>
<div class="paragraph">
<p><strong>Arquillian Persistence Extension</strong> can be customized in the similar way
as any other components from Arquillian ecosystem - through
<code>&lt;extension&gt;</code> elements defined in <code>arquillian.xml</code>. Following sections
describe all possible settings which you can use to tweak the extension
for your environment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Transaction management is delegated to Transaction Extension as of
<code>1.0.0.Alpha6</code> version. Therefore if you want to specify JNDI for the
<code>UserTransaction</code>, please use following snippet in the <code>arquillian.xml</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transaction</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">manager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>java:jboss/UserTransaction<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="general-settings"><a class="anchor" href="#general-settings"></a>General Settings</h5>
<div class="paragraph">
<p>You can customize <strong>Arquillian Persistence Extension</strong> configuration in
<code>arquillian.xml</code> by adding following element:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>java:app/datasources/mssql_ds<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>List of all available properties</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultDataSource</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the default data source used to interact with the database
(seeding, comparing etc). Required if not specified by using
<code>@DataSource</code> annotation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultTransactionMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COMMIT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transaction mode for running the tests if not specified explicitly by
using <code>@Transactional</code>. Possible values: COMMIT, ROLLBACK or DISABLED.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dumpData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables database state dumping in following phases BEFORE_SEED,
AFTER_SEED, BEFORE_CLEAN, AFTER_CLEAN. Might be handy for debugging.
(Boolean.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dumpDirectory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS-specific tmp directory defined in <code>java.io.tmpdir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Folder where all database dumps will be stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultCleanupPhase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AFTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines default cleanup phase. Possible values: BEFORE, AFTER, NONE. If
not defined on the test method or class level this setting is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultCleanupStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STRICT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines strategy of cleaning database content for the test. Possible
values: STRICT, USED_ROWS_ONLY orÂ USED_TABLES_ONLY.Â If not defined on
the test method or class level this setting is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultDataSeedStrategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INSERT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines strategy of inserting data to the database. Possible values:
INSERT, CLEAN_INSERT, UPDATE or REFRESH.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="dbunit-specific-settings"><a class="anchor" href="#dbunit-specific-settings"></a>DBUnit Specific Settings</h5>
<div class="paragraph">
<p><strong>Arquillian Persistence Extension</strong> provides a way to customize
underlying behaviour of DBUnit
(<a href="http://dbunit.sourceforge.net/properties.html">exposed as properties and
features</a>) and some other customizations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence-dbunit</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">datatypeFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>org.dbunit.ext.mssql.MsSqlDataTypeFactory<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">useIdentityInsert</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">excludePoi</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>List of all available properties</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Default Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultDataSetLocation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"datasets/"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Folder where all datasets are located.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultDataSetFormat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default format of data sets when file name is inferred from test method
name, when file is not specified in <code>@UsingDataSet</code> or
<code>@ShouldMatchDataSet</code>. Other supported formats are EXCEL, YAML and JSON.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludePoi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Excludes Apache POI from packaging process, which results in slimier
deployment. If you are not using Excel datasets you can safely turn it
off.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>batchedStatements</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable usage of JDBC batched statement by DBUnit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>caseSensitiveTableNames</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable case sensitive table names. If enabled, DBUnit handles
all table names in a case sensitive way.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qualifiedTableNames</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable multiple schemas support. If enabled, DBUnit access
tables with names fully qualified by schema using this format:
SCHEMA.TABLE.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datatypeWarning</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable the warning message displayed when DBUnit encounter an
unsupported data type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>skipOracleRecycleBinTables</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable or disable the processing of oracle recycle bin tables (tables
starting with BIN$). Oracle 10g recycle bin tables may break DBUnit&#8217;s
assumption of tables name uniqueness within a schema since these table
are case sensitive. Enable this feature for Oracle 10g databases until
the bug in the oracle driver is fixed, which incorrectly reports this
system tables to DVUnit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>escapePattern</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows schema, table and column names escaping. The property value is an
escape pattern where the ? is replaced by the name. For example, the
pattern "
[?]
" is expanded as "
[MY_TABLE]
" for a table named "MY_TABLE". The most common escape pattern is
"\"?\"" which surrounds the table name with quotes (for the above
example it would result in "\"MY_TABLE\""). As a fallback if no
questionmark is in the given string and its length is one it is used to
surround the table name on the left and right side. For example the
escape pattern "\"" will have the same effect as the escape pattern
"\"?\"".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tableType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to configure the list of table types recognized by DBUnit.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>datatypeFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.dbunit.dataset.
datatype.
DefaultDataTypeFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to configure the DataType factory. You can replace the default
factory to add support for non-standard database vendor data types.
Provided class must implement
<code>org.dbunit.dataset.datatype.IDataTypeFactory</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>statementFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.dbunit.database.
statement.
PreparedStatementFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to configure the statement factory. Provided class must implement
<code>org.dbunit.database.statement.IStatementFactory</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resultSetTableFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.dbunit.database.
IResultSetTableFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to configure the ResultSet table factory. Provided class must
implement <code>org.dbunit.database.CachedResultSetTableFactory</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>primaryKeyFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use to override primary keys detection. Provided class must implement
<code>org.dbunit.dataset.filter.IColumnFilter</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>identityColumnFilter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use to override IDENTITY column detection (MS SQL specific solution).
Provided class must implement <code>org.dbunit.dataset.filter.IColumnFilter</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>batchSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the batch updates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fetchSize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The statement fetch size for loading data into a result set table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadataHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.dbunit.database.
DefaultMetadataHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to configure the handler used to control database metadata related
methods. Provided class must implement
<code>org.dbunit.database.IMetadataHandler</code>
</p><p class="tableblock">For MySQL users&#8230;&#8203;
</p><p class="tableblock">If you are using MySQL, you must use
<code>org.dbunit.ext.mysql.MySqlMetadataHandler</code> or you will get the "No
columns found" error. See <a href="http://sourceforge.net/p/dbunit/bugs/226/" class="bare">http://sourceforge.net/p/dbunit/bugs/226/</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>useIdentityInsert</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disables MS SQL Server automatic identifier generation for the execution
of inserts. For usage with Microsoft driver you should append your JDBC
connection with "SelectMethod=cursor".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>excludeTablesFromCleanup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>empty</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of tables to be excluded from cleanup procedure.<br>
Â  Â  * Especially handy for sequence tables which are most likely to be
cleared<br>
Â  Â  * when using STRICT cleanup strategy.<br>
Comma separated list of table names to be excluded from cleanup
procedure. Especially handy for sequence tables which are otherwise
cleared when using STRICT cleanup strategy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>schema</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>empty</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database schema name to be used by DBUnit</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="sql-scripts-customization"><a class="anchor" href="#sql-scripts-customization"></a>SQL Scripts Customization</h5>
<div class="paragraph">
<p><strong>Arquillian Persistence Extension</strong> allows you to customize the way how
SQL scripts are handled.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persistence-script</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sqlStatementDelimiter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>GO<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>List of all available properties</strong></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property name</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultSqlScriptLocation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"scripts/"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Folder where all custom SQL scripts are located.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scriptsToExecuteBeforeTest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ad-hoc scripts or file locations to be used before every test. Might be
handy for turning off integrity checks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>scriptsToExecuteAfterTest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ad-hoc scripts or file locations to be used after every test. Could be
used to revert operations applied by scriptsToExecuteBeforeTest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>defaultCleanupUsingScriptPhase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AFTER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines default cleanup phase for custom SQL scripts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sqlStatementDelimiter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines char sequence indicating end of SQL statement</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-03-21 18:38:30 UTC
</div>
</div>
</body>
</html>